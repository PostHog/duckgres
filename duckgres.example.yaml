# Duckgres Configuration
# Copy this file to duckgres.yaml and customize as needed

# Server binding
host: "0.0.0.0"
port: 5432

# Directory for DuckDB database files (one per user)
data_dir: "./data"

# TLS configuration (required)
tls:
  cert: "./certs/server.crt"
  key: "./certs/server.key"

# User credentials (username: password)
users:
  postgres: "postgres"
  alice: "alice123"
  bob: "bob123"

# DuckDB extensions to load on database initialization
# Extensions are installed (downloaded if needed) and loaded automatically
# Common extensions: httpfs, parquet, json, sqlite, postgres, mysql, excel
# Default: ducklake (loaded even without config file)
extensions:
  - ducklake
  # - httpfs
  # - parquet

# DuckLake configuration (optional)
# When configured, DuckLake catalog is automatically attached on connection
# See: https://ducklake.select/docs/stable/duckdb/usage/connecting
ducklake:
  # Full connection string for the DuckLake metadata database
  # Examples:
  #   - "postgres:host=localhost user=ducklake password=secret dbname=ducklake"
  #   - "postgres:host=ducklake.example.com user=ducklake password=secret dbname=ducklake"
  # metadata_store: "postgres:host=localhost user=ducklake password=secret dbname=ducklake"

  # S3-compatible object storage for data files (optional)
  # If not specified, data is stored alongside the metadata
  # object_store: "s3://bucket/path/"

  # S3 credential provider: "config" (explicit) or "credential_chain" (AWS SDK)
  # Default: "config" if s3_access_key is set, otherwise "credential_chain"
  # s3_provider: "config"

  # Option 1: Explicit credentials (for MinIO or when you have access keys)
  # s3_endpoint: "localhost:9000"      # MinIO or custom S3 endpoint
  # s3_access_key: "minioadmin"        # Access key ID
  # s3_secret_key: "minioadmin"        # Secret access key
  # s3_region: "us-east-1"             # AWS region (default: us-east-1)
  # s3_use_ssl: false                  # Use HTTPS for S3 connections
  # s3_url_style: "path"               # "path" or "vhost" (default: path)

  # Option 2: AWS credential chain (for AWS S3 with IAM roles, env vars, etc.)
  # Uses AWS SDK credential chain: env vars -> config files -> instance metadata
  # See: https://duckdb.org/docs/stable/core_extensions/httpfs/s3api#credential_chain-provider
  # s3_provider: "credential_chain"
  # s3_chain: "env;config"             # Which sources to check (env, config, sts, sso, instance, process)
  # s3_profile: "my-profile"           # AWS profile name (for config chain)
  # s3_region: "us-west-2"             # Override auto-detected region

# Rate limiting configuration (optional - these are the defaults)
rate_limit:
  # Max failed auth attempts before banning an IP
  max_failed_attempts: 5
  # Time window for counting failed attempts (e.g., "5m", "1h")
  failed_attempt_window: "5m"
  # How long to ban an IP after too many failed attempts
  ban_duration: "15m"
  # Max concurrent connections from a single IP (0 = unlimited)
  max_connections_per_ip: 100
